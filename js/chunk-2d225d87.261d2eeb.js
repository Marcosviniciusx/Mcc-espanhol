(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d225d87"],{e5ab:function(t,e,s){"use strict";s.r(e);s("14d9");var a=function(){var t=this,e=t._self._c;return e("lock-scroll",{attrs:{locked:t.lockScroll}},[e("lock-screen",{attrs:{locked:t.lockScreen}}),e("app-layout",[e("div",{staticClass:"flex flex-col items-center pb-32"},[e("div",{staticClass:"w-full px-6 pt-6 2xl:w-3/5 2xl:px-0"},[e("div",{staticClass:"flex flex-col md:flex-row py-4"},[e("div",{staticClass:"flex flex-row items-center"},[e("sa-icon-button",{attrs:{"with-bg":"",iconClass:"bx bx-left-arrow-alt"},on:{click:function(e){return t.$router.push({name:"orders.index"})}}}),e("span",{staticClass:"mx-2 text-lg font-bold"},[t._v(" Orden de servicio ")])],1),e("div",{staticClass:"flex flex-row items-center ml-auto"},[e("div",{staticClass:"whitespace-nowrap"},[t.id?e("el-button",{staticClass:"el-button--success",class:{"p-2":t.isMobile},on:{click:t.whatsapp}},[t.isMobile?t._e():e("span",[t._v("WhatsApp")]),t.isMobile?e("i",{staticClass:"text-md bx bxl-whatsapp"}):t._e()]):t._e(),t.id?e("el-button",{staticClass:"el-button--info",class:{"p-2":t.isMobile},on:{click:t.notes}},[t.isMobile?t._e():e("span",[t._v("Notas")]),t.isMobile?e("i",{staticClass:"text-md bx bx-note"}):t._e()]):t._e(),t.id&&!t.isMobile?e("el-dropdown",{staticClass:"mx-2",attrs:{"split-button":"",type:"warning"},on:{command:t.print}},[e("span",[t._v("Imprimir")]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"default"}},[t._v("Carta")]),e("el-dropdown-item",{attrs:{command:"thermal"}},[t._v("TÃ©rmico")]),e("el-dropdown-item",{attrs:{command:"sticker"}},[t._v("Sticker")])],1)],1):t._e(),t.id&&t.isMobile?e("el-dropdown",{staticClass:"mx-2",attrs:{trigger:"click"},on:{command:t.print}},[e("span",{staticClass:"el-button el-button--warning p-2"},[e("i",{staticClass:"text-md bx bx-printer"}),e("i",{staticClass:"text-md el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"default"}},[t._v("Carta")]),e("el-dropdown-item",{attrs:{command:"thermal"}},[t._v("TÃ©rmico")]),e("el-dropdown-item",{attrs:{command:"sticker"}},[t._v("Sticker")])],1)],1):t._e(),e("quick-start-tip",{attrs:{title:"Guarda tus cambios",content:"Cuando guardas una orden se manda un correo en automatico al cliente.\n                NO OLVIDE GUARDAR SUS CAMBIOS.",placement:"bottom","bg-purple":!1,value:t.showQuickStartTip},on:{onNextStep:t.handleNextStep}},[e("div",{staticClass:"inline-block",class:{"quick-start-selected":8===t.$store.state.quickStart.step}},[e("el-button",{staticClass:"el-button--primary",class:{"p-2":t.isMobile},on:{click:t.submit}},[t.isMobile?t._e():e("span",[t._v("Guardar")]),t.isMobile?e("i",{staticClass:"text-md bx bx-save"}):t._e()])],1)]),t.id&&!t.isMobile?e("el-dropdown",{staticClass:"mx-2",attrs:{"split-button":"",type:"danger"},on:{command:t.close}},[e("span",[t._v("Cerrar")]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.Finalized]}},[t._v("Entregado")]),e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.Rejected]}},[t._v("Rechazado")]),e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.NoSolution]}},[t._v("Sin SoluciÃ³n")]),e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.Warranty]}},[t._v("GarantÃ­a")])],1)],1):t._e(),t.id&&t.isMobile?e("el-dropdown",{staticClass:"mx-2",attrs:{trigger:"click"},on:{command:t.close}},[e("span",{staticClass:"el-button el-button--danger p-2"},[e("i",{staticClass:"text-md bx bx-x"}),e("i",{staticClass:"text-md el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.Finalized]}},[t._v("Entregado")]),e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.Rejected]}},[t._v("Rechazado")]),e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.NoSolution]}},[t._v("Sin SoluciÃ³n")]),e("el-dropdown-item",{attrs:{command:t.statuses[t.OrderStatusEnum.Warranty]}},[t._v("GarantÃ­a")])],1)],1):t._e()],1)])]),t.errors.length>0?e("div",{staticClass:"px-4 text-red-500"},[e("ul",{staticClass:"p-2 list-disc"},t._l(t.errors,(function(s){return e("li",{key:s.field},[t._v(t._s(s.message))])})),0)]):t._e(),e("div",{staticClass:"lg:flex xl:flex lg:flex-row xl:flex-row md:space-x-2 lg:space-x-2 xl:space-x-2"},[e("div",{staticClass:"flex-col sm:w-full md:w-2/3 lg:w-2/3 xl:w-2/3"},[e("el-tabs",{model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[e("el-tab-pane",{attrs:{name:"repairs"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("div",{staticClass:"px-2 space-x-1"},[e("span",[t._v("Reparaciones")]),e("span",{staticClass:"px-1 py-0.5 text-gray-500 bg-gray-200 rounded-full text-sm font-bold whitespace-pre-wrap"},[t._v(" "+t._s(t.orderDevicesCountDescription)+" ")])])]),e("devices-list",{attrs:{"active-device":t.activeDevice}})],1),e("el-tab-pane",{attrs:{name:"sales"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("div",{staticClass:"px-2 space-x-1"},[e("span",[t._v("Ventas")]),e("span",{staticClass:"px-1 py-0.5 text-gray-500 bg-gray-200 rounded-full text-sm font-bold whitespace-pre-wrap"},[t._v(" "+t._s(t.orderProductsCountDescription)+" ")])])]),e("products-list")],1)],1)],1),e("div",{staticClass:"flex-col sm:w-full md:w-2/3 lg:w-1/3 xl:w-1/3 pt-12 mt-1.5 space-y-4"},[e("client-block"),e("payment-block"),e("details-block"),e("images-block")],1)])]),e("el-dialog",{attrs:{visible:t.paymentMethod.show,width:t.dialogClientWidth,"close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.paymentMethod,"show",e)}}},[e("div",[e("div",{staticClass:"mb-4"},[e("span",{staticClass:"text-md font-bold break-words"},[t._v(" Por favor, selecciona un metodo de pago para finalizar la orden ")])]),e("span",[t._v("Metodo de Pago")]),e("el-select",{staticClass:"w-full",on:{change:function(e){return t.paymentMethod.callback()}},model:{value:t.paymentMethod.value,callback:function(e){t.$set(t.paymentMethod,"value",e)},expression:"paymentMethod.value"}},t._l(t.paymentMethods,(function(s){return e("el-option",{key:s.id,attrs:{label:s.name,value:s.id}},[e("div",{staticClass:"flex flex-row items-center"},[e("span",{staticClass:"ml-2"},[t._v(" "+t._s(s.name)+" ")])])])})),1)],1)])],1)])],1)},i=[],o=s("4081"),r=s("cfd9"),n=s("ead0"),l=s("5a50"),d=s("e419"),c=s("8266"),u=s("4cf1"),p={name:"OrdersFormIndex",mixins:[c["a"]],components:{AppLayout:()=>s.e("chunk-2b774e2e").then(s.bind(null,"c987")),DevicesList:()=>s.e("chunk-2d22bf35").then(s.bind(null,"f0c8")),ProductsList:()=>s.e("chunk-1faecadc").then(s.bind(null,"5f47")),ClientBlock:()=>s.e("chunk-c47e9058").then(s.bind(null,"608b")),DetailsBlock:()=>s.e("chunk-2d215c9f").then(s.bind(null,"c062")),PaymentBlock:()=>s.e("chunk-2d0c8d9a").then(s.bind(null,"5746")),ImagesBlock:()=>s.e("chunk-cc0480fe").then(s.bind(null,"873e"))},created(){window.addEventListener("resize",this.resize),o["d"].resetState(),this.$state=o["e"],this.resize()},destroyed(){window.removeEventListener("resize",this.resize)},data(){return{id:void 0,activeTab:"repairs",errors:[],statuses:this.$store.state.catalogs.statuses,OrderStatusEnum:l["k"],isMobile:!1,lockScreen:!1,lockScroll:!1,activeDevice:null,showQuickStartTip:!1,paymentMethod:{show:!1,value:null,callback:()=>{}},paymentMethods:[],dialogClientWidth:"30%"}},watch:{"$store.state.quickStart.step"(t){8===t&&(this.showQuickStartTip=!0)}},computed:{orderDevicesCountDescription(){return o["b"].orderDevicesCount()},orderProductsCountDescription(){return o["b"].orderProductsCount()}},async mounted(){this.id=this.$route.params.id,this.lockScreen=this.$route.params.lockScreen||!1,this.id&&await this.getOrder(this.$route.params.id),this.paymentMethods=await r["a"].getPaymentMethods()},methods:{async notes(){n["a"].show(this.id)},async print(t){if(!t)return;await o["a"].validateOrder();const e=o["e"].order.orderDevices.filter(t=>!t.deviceModelId);if(e.length)return void this.$toastr.e("Error al capturar dispositivo");const s=o["c"].mapPostRequest();await r["a"].update({...s,id:this.id}),await this.$router.push({name:"invoices."+t,params:{order:{...this.$state.order,id:this.id}}})},async submit(){try{await o["a"].validateOrder();const t=o["e"].order.orderDevices.length&&o["e"].order.orderDevices.filter(t=>!t.deviceModelId);if(t.length)return void this.$toastr.e("Error al capturar dispositivo");const e=o["c"].mapPostRequest();if(this.id)await r["a"].update({...e,id:this.id}),await this.$router.push({name:"invoices.default",params:{id:this.id}}),await this.$toastr.s("Se actualizo con exito");else{const{id:t}=await r["a"].create(e),s=0===e.orderDevices.length&&e.orderProducts.length>0;s?this.paymentMethod={show:!0,value:null,callback:async()=>{const e=this.statuses[l["k"].Finalized];await r["a"].updateStatus({id:t,status:e.value,paymentMethod:this.paymentMethod.value}),await this.createSuccess(t)}}:await this.createSuccess(t)}}catch(t){this.errors=this.$state.errors}},async createSuccess(t){await this.$router.push({name:"invoices.default",params:{id:t}}),await this.$toastr.s("Se creo con exito")},whatsapp(){this.$state.client.countryCode?Object(d["a"])({code:this.$state.client.countryCode,phone:this.$state.client.phone}):this.$toastr.e("El Cliente debe tener registrado el CÃ³digo de Area")},async close(t){if(t)switch(t){case this.statuses[l["k"].Finalized]:this.paymentMethod={show:!0,value:null,callback:async()=>{await r["a"].updateStatus({id:this.id,status:t.value,paymentMethod:this.paymentMethod.value}),await this.$router.push({name:"invoices.default",params:{id:this.id}})}},this.resize();break;case this.statuses[l["k"].Rejected]:await r["a"].updateStatus({id:this.id,status:t.value}),await this.$router.push({name:"invoices.default",params:{id:this.id}});break;case this.statuses[l["k"].NoSolution]:await r["a"].updateStatus({id:this.id,status:t.value}),await this.$router.push({name:"invoices.default",params:{id:this.id}});break;case this.statuses[l["k"].Warranty]:await r["a"].applyWarranty(this.id),await this.$router.push({name:"invoices.default",params:{id:this.id}});break;default:}},async getOrder(t){const e=await r["a"].getById(t),s=o["c"].mapGetResponse(e);this.$state.order=s,this.$state.client=s.client,this.activeDevice=s.orderDevices.length?0:null},resize(){const t=this.getPercentageWidth();this.isMobile="90%"===t,this.dialogClientWidth=t},handleNextStep(){const t=this.$store.state.quickStart.step;this.$store.dispatch(u["b"],{step:t+1}),8===t&&(this.showQuickStartTip=!1,this.$router.push({name:"invoices.default",params:{id:this.id,lockScroll:!0,lockScreen:!0}}))}}},m=p,h=s("2877"),w=Object(h["a"])(m,a,i,!1,null,null,null);e["default"]=w.exports}}]);
//# sourceMappingURL=chunk-2d225d87.261d2eeb.js.map